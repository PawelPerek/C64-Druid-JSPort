let player, cols = 0, rows = 0;
let num = new Sprite(new Img("img/num.png"), 14 * 2, 14 * 2)
let ptr = new Img("img/pointer.png");
let spells = ["water", "fire", "electricity"];
let current_spell = spells[0];
let bullet = null;
let enemies = [];
let grounds = [];
let waters = [];

const chests = [
    [91, 89, 72], 
    [10, 20, 10],
    [5, 0, 0],
    [0, 30, 12],
    [10, 20, 15],
    [11, 8, 5],
    [2, 0, 0],
    [35, 25, 3],
    [20, 0, 11],
    [7, 13, 29],
    [15, 20, 36]
];

let opened = [];

document.addEventListener("DOMContentLoaded", async () => {
    game = new Game("2d");
    document.body.append(game.view);
    let ctx = game.ctx();

    bullet = new Projectile(ctx);

    let json = [[18,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,19],[16,0,1,0,4,0,0,0,0,0,0,3,1,4,30,25,1,1,3,0,2,4,30,2,3,0,0,18,17,19,0,16],[16,0,2,0,5,2,0,18,17,17,19,0,2,5,0,20,17,17,24,4,1,5,0,31,0,18,17,21,30,16,0,16],[16,0,1,2,34,1,0,16,30,0,16,0,2,2,0,1,25,0,0,5,31,34,1,2,0,16,2,0,0,16,0,16],[16,0,2,4,0,2,0,22,0,1,16,0,2,31,0,31,16,0,2,34,1,23,17,17,19,16,0,0,18,21,0,16],[16,0,31,5,0,2,0,25,0,31,16,0,31,0,1,0,22,0,1,0,31,0,0,0,16,20,24,0,22,30,0,16],[16,2,0,34,1,2,0,20,17,17,21,4,1,0,2,0,0,0,1,0,4,0,23,17,21,4,0,0,3,1,4,16],[16,2,1,0,31,31,0,0,0,0,1,5,31,1,31,3,2,2,23,24,5,0,0,0,0,5,1,0,0,31,5,16],[32,6,6,10,11,11,11,7,6,6,6,6,6,6,6,10,11,11,7,6,6,6,6,10,14,34,31,0,1,3,1,16],[32,9,12,8,6,6,6,6,9,12,12,12,8,6,6,6,6,6,6,6,6,6,6,6,6,27,28,10,33,14,0,16],[16,2,1,30,1,0,2,0,1,1,4,30,4,4,15,12,12,12,13,2,4,15,12,8,6,27,28,6,6,6,6,32],[16,3,31,0,31,1,31,3,31,31,5,0,5,5,1,0,1,0,3,31,5,3,0,0,0,0,30,15,8,6,6,32],[16,29,1,4,0,31,18,17,24,0,1,0,3,34,31,2,31,1,0,2,18,17,17,17,24,0,3,18,17,24,1,16],[16,0,2,5,23,17,21,1,2,0,31,0,0,2,3,31,3,31,0,31,16,30,1,35,1,0,2,16,30,1,2,16],[16,0,31,34,0,3,0,31,26,17,17,17,24,31,0,0,2,1,1,1,20,17,36,17,36,17,36,21,0,31,31,16],[20,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,36,36,36,36,17,17,17,17,17,17,17,17,17,17,17,21]];
   
    let map = new Map(json);
    
    player = new Player(new Sprite(new Img("img/walk.png"), 44, 42), {
        up: "ArrowUp",
        down: "ArrowDown",
        left: "ArrowLeft",
        right: "ArrowRight",
        shoot: " ",
        change: "p"
    });
    
    game.on("keydown", e => {
        if(e.key == "Enter")
            game.pause();
    })

    game.render(() => {
        bullet.update();
    })

    
    game.render(() => {
        if(enemies.length < 20) {
            let rand = parseInt(Math.random() * grounds.length);
            new Enemy("ghost", grounds[rand].x * 64, grounds[rand].y * 64);
        }

        for(let enemy of enemies)
            enemy.update(game.ctx());
    })
})

